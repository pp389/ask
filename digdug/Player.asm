PROC CLEAR_MOVE_1
	PX_X EQU [WORD PTR BP + 6]
	PX_Y EQU [WORD PTR BP + 4]

	PUSH BP
	MOV  BP, SP
	
	PUSH AX
	
	ADD PX_X, 4
	ADD PX_Y, 4

	PUSH PX_X
	PUSH PX_Y
	CALL GRAPHICS_GETCOLOR
	
	CMP AL, BROWN
	JZ  @@CLEAR
	
@@CLEAR:
	STC	
	JMP @@END_PROC

@@END_PROC:
	POP AX
	POP BP
	RET 4
ENDP CLEAR_MOVE_1


PROC PLAYER_MOVE
	PUSH CX
	PUSH DX

	MOV CX, [PACX]
	MOV DX, [PACY]

	ADD CL, [BYTE PTR DIR + 1]
	ADD DL, [BYTE PTR DIR]


	CMP CL, 0F7h
	JZ  @@OVERFLOW_L
	
	CMP CX, 207
	JZ  @@OVERFLOW_R
	JMP @@IS_CLEAR_MOVE
	
	@@OVERFLOW_L:
	MOV CX, 198
	JMP @@PLAYER_PRINT
	
	@@OVERFLOW_R:
	MOV CX, 0
	JMP @@PLAYER_PRINT


@@IS_CLEAR_MOVE:  
	PUSH CX
	PUSH DX
	CALL CLEAR_MOVE_1	
	
	JNC @@CHECK_NEXT_DIR

@@PLAYER_PRINT: 
	PUSH CX
	PUSH DX
	CALL PLAYER_EATDOTS
	
	CALL PLAYER_CLEAR
	
	MOV [PACX], CX
	MOV [PACY], DX
	CALL PLAYER_ANIMATION


@@CHECK_NEXT_DIR: 
	CMP [NEXTDIR], DIR_N
	JZ  @@END_PROC

	MOV CX, [PACX]
	MOV DX, [PACY]

	ADD CL, [BYTE PTR NEXTDIR + 1]
	ADD DL, [BYTE PTR NEXTDIR]
	
	PUSH CX
	PUSH DX
	CALL CLEAR_MOVE_1
	JNC @@END_PROC

	PUSH [NEXTDIR]
	POP  [DIR]

@@END_PROC:
	POP DX
	POP CX
	CALL GAME_INPUT
	RET
ENDP PLAYER_MOVE


PROC PLAYER_PRINT
	PUSH OFFSET PACMAN_0
	PUSH YELLOW
	PUSH [PACX]
	PUSH [PACY]
	CALL GRAPHICS_PRINTIMAGE
	RET
ENDP PLAYER_PRINT	


PROC PLAYER_CLEAR
	PUSH [PACX]
	PUSH [PACY]	
	
	PUSH 9	
	PUSH 9	
	
	PUSH black
	
	CALL GRAPHICS_PRINTRECT
	
	RET
ENDP PLAYER_CLEAR

PROC PLAYER_EATDOTS
	PX_X EQU [WORD PTR BP + 6]
	PX_Y EQU [WORD PTR BP + 4]

	PUSH BP
	MOV  BP, SP
	
	PUSH AX
	PUSH BX

	ADD PX_X, 4
	ADD PX_Y, 4

	PUSH PX_X
	PUSH PX_Y
	CALL GRAPHICS_GETCOLOR
	
		CMP AL, BROWN
		JZ  @@WALL

		CMP AL, BLACK
		JZ  @@END_PROC

@@WALL:
	PUSH PX_X
	PUSH PX_Y
	
	PUSH 5
	PUSH 5
	PUSH BLACK
	CALL GRAPHICS_PRINTRECT
	JMP @@END_PROC

@@END_PROC:
	POP BX
	POP AX
	POP BP

RET 4

ENDP PLAYER_EATDOTS


PROC PLAYER_ANIMATION
	PUSH AX
	PUSH BX
	
	CALL PLAYER_CLEAR
	
	MOV BX, OFFSET PACMAN_0
	
	
@@PRINT_PAC: 
	PUSH [BX]
	PUSH YELLOW
	PUSH [PACX]
	PUSH [PACY]
	
	CALL GRAPHICS_PRINTIMAGE

@@END_PROC:
	POP BX
	POP AX
	RET

ENDP PLAYER_ANIMATION

